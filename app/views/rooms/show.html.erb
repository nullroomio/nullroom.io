<%# ── Room Show ─────────────────────────────────────────────────────── %>
<div
  class="relative w-full min-h-screen flex flex-col items-center justify-start py-6 px-4"
  data-controller="room"
  data-room-room-id-value="<%= @room_id %>"
  data-room-turn-servers-value="<%= @ice_servers.to_json %>"
>

  <%# ── Top nav ─────────────────────────────────────────────────────── %>
  <header class="w-full max-w-lg flex items-center justify-between mb-6">
    <%= render "shared/logo", size: "sm" %>
    <span class="flex items-center gap-2 text-xs font-mono text-signal-green">
      <span class="w-2 h-2 rounded-full bg-signal-green animate-pulse"></span>
      Zero-Trace Active
    </span>
  </header>

  <%# ── Glass card ──────────────────────────────────────────────────── %>
  <div class="glass w-full max-w-lg flex flex-col overflow-hidden">

    <%# ── Status bar ──────────────────────────────────────────────────── %>
    <div class="flex items-center justify-between px-5 py-3 border-b border-white/8">
      <div class="flex items-center gap-2">
        <div
          data-room-target="statusDot"
          class="w-2.5 h-2.5 rounded-full bg-yellow-400 animate-pulse"
        ></div>
        <span
          data-room-target="statusText"
          class="text-xs font-mono text-secure-gray tracking-widest uppercase"
        >Room Status: Signaling…</span>
      </div>
      <span
        data-room-target="timerDisplay"
        class="font-mono text-sm text-trace-white tabular-nums"
      >30:00</span>
    </div>

    <%# ── Room link (privacy shroud by default) ───────────────────────── %>
    <div class="px-5 py-4 border-b border-white/8">
      <p class="text-xs font-mono text-secure-gray mb-2">
        Room Link
        <span class="text-white/30">(click-to-reveal)</span>
      </p>
      <div class="flex items-center gap-2">
        <input
          data-room-target="shareLink"
          type="text"
          readonly
          value="<%= request.url %>"
          aria-label="Room link"
          class="privacy-shroud flex-1 min-w-0 px-3 py-2 rounded-lg bg-white/5 border border-white/8 text-trace-white text-xs font-mono focus:outline-none focus:border-status-blue hover:border-white/20 transition-colors"
          onclick="this.classList.add('revealed'); this.select();"
        />
        <button
          data-action="room#copyLink"
          aria-label="Copy link"
          class="shrink-0 p-2 rounded-lg bg-white/5 border border-white/8 text-secure-gray hover:text-trace-white hover:border-white/20 active:scale-95 transition-all focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-status-blue cursor-pointer"
        >
          <%= render "shared/icon", name: "clipboard", css: "w-4 h-4" %>
        </button>
      </div>
    </div>

    <%# ── Messages area ────────────────────────────────────────────────── %>
    <div
      data-room-target="messagesContainer"
      class="flex-1 min-h-64 max-h-96 overflow-y-auto px-5 py-4 space-y-2"
    >
      <p data-room-target="waitingPlaceholder"
         class="text-xs font-mono text-secure-gray text-center py-12">
        Waiting for peer to join…
      </p>
    </div>

    <%# ── Message input & actions ──────────────────────────────────────── %>
    <div class="flex items-center gap-2 px-5 py-4 border-t border-white/8">
      <input
        data-room-target="messageInput"
        type="text"
        placeholder="Type a message..."
        disabled
        class="flex-1 min-w-0 px-4 py-2.5 rounded-lg bg-white/5 border border-white/8 text-trace-white text-sm font-sans placeholder-secure-gray focus:outline-none focus:border-status-blue disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
        data-action="keydown.enter->room#sendMessage"
      />
      <button
        data-room-target="sendButton"
        data-action="room#sendMessage"
        disabled
        aria-label="Send message"
        class="shrink-0 p-2.5 rounded-lg bg-status-blue text-white hover:brightness-110 active:scale-95 disabled:opacity-40 disabled:cursor-not-allowed transition-all focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-status-blue cursor-pointer"
      >
        <%= render "shared/icon", name: "send", css: "w-4 h-4" %>
      </button>
      <button
        data-action="room#destroyRoom"
        aria-label="Destroy room"
        class="shrink-0 flex items-center gap-1.5 px-3 py-2.5 rounded-lg border border-red-800/60 text-red-400 text-xs font-sans hover:bg-red-950/50 hover:border-red-700 active:scale-95 transition-all focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-red-500 cursor-pointer"
      >
        <%= render "shared/icon", name: "trash", css: "w-4 h-4" %>
        <span class="hidden sm:inline">Destroy Room</span>
      </button>
    </div>

    <%# ── File Transfer Zone (hidden until P2P connected + file_sharing enabled) ── %>
    <div
      data-room-target="fileZone"
      class="hidden px-5 pb-4"
    >
      <%# Drop / click area %>
      <div
        data-action="dragover->room#preventDrop drop->room#handleDrop click->room#triggerFileInput"
        class="relative flex items-center justify-center gap-2 px-4 py-3 rounded-lg border border-dashed border-white/20 text-secure-gray hover:border-status-blue hover:text-trace-white transition-colors cursor-pointer select-none"
      >
        <%= render "shared/icon", name: "paperclip", css: "w-4 h-4 shrink-0" %>
        <span class="text-xs font-mono">
          Drop a file or click to select
          <span class="text-white/30">(max 24 MB)</span>
        </span>
        <%# Invisible native file picker layered over the styled div %>
        <input
          data-room-target="fileInput"
          data-action="change->room#uploadFile"
          type="file"
          class="absolute inset-0 opacity-0 cursor-pointer"
          tabindex="-1"
          aria-hidden="true"
        />
      </div>

      <%# Progress bar (hidden until a transfer is in flight) %>
      <div data-room-target="fileProgress" class="hidden mt-2 space-y-1">
        <span
          data-room-target="fileProgressLabel"
          class="block text-xs font-mono text-secure-gray truncate"
        >Transferring…</span>
        <div class="h-1 bg-white/10 rounded-full overflow-hidden">
          <div
            data-room-target="fileProgressBar"
            class="h-full bg-status-blue rounded-full transition-all duration-200"
            style="width: 0%"
          ></div>
        </div>
      </div>
    </div>

  </div><%# /glass card %>

  <%# ── Room Terminated Modal (initially hidden) ─────────────────────── %>
  <div
    data-room-target="terminatedModal"
    class="hidden fixed inset-0 bg-null-deep/80 backdrop-blur-sm flex items-center justify-center z-50 px-4"
  >
    <div class="glass w-full max-w-sm p-8 text-center space-y-5">
      <div class="w-12 h-12 mx-auto rounded-full border border-red-800/60 flex items-center justify-center text-red-400">
        <%= render "shared/icon", name: "trash", css: "w-6 h-6" %>
      </div>
      <div>
        <h2 class="font-sans font-semibold text-trace-white text-lg">Room Terminated</h2>
        <p class="mt-2 text-sm font-sans text-secure-gray leading-relaxed">
          One participant left. All traces are now cleared.
        </p>
      </div>
      <button
        data-action="room#closeRoom"
        class="w-full px-6 py-3 rounded-lg border border-red-800/60 text-red-400 text-sm font-sans font-semibold hover:bg-red-950/50 active:scale-95 transition-all focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-500 cursor-pointer"
      >
        Close
      </button>
    </div>
  </div>

  <%# ── Error Toast (initially hidden) ─────────────────────────────── %>
  <div
    data-room-target="errorToast"
    class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-red-950/90 backdrop-blur-md border border-red-800/60 text-red-300 px-5 py-3 text-xs font-mono rounded-lg shadow-lg z-50"
  >
    <span data-room-target="errorToastText"></span>
  </div>

  <%# ── Brand sparkle mark ─────────────────────────────────────────── %>
  <div class="fixed bottom-6 right-6 text-trace-white/20 pointer-events-none" aria-hidden="true">
    <%= render "shared/icon", name: "sparkle", css: "w-8 h-8" %>
  </div>

</div>
